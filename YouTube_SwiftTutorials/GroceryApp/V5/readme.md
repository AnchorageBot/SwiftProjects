5th draft - refactored for ease of maintenance
